---
name: Pipeline Orchestrator
status: open
created: 2025-12-22T03:28:32Z
updated: 2025-12-22T03:32:46Z
github: https://github.com/1psychoQAQ/verdict-agent/issues/6
depends_on: [4, 5]
parallel: false
conflicts_with: []
---

# Task: Pipeline Orchestrator

## Description

Implement the pipeline that orchestrates Agent A → Agent B → Artifact generation. Handle validation between steps, error recovery, and timeout management.

## Acceptance Criteria

- [ ] Pipeline struct with `Execute(input string) (*PipelineResult, error)`
- [ ] Sequential execution: Agent A → validate → Agent B → validate
- [ ] JSON schema validation at each handoff
- [ ] Timeout handling (configurable, default 10 minutes total)
- [ ] Graceful error messages for each failure point
- [ ] Context cancellation support

## Technical Details

### Pipeline Design
```go
type Pipeline struct {
    verdictAgent   *VerdictAgent
    executionAgent *ExecutionAgent
    timeout        time.Duration
}

type PipelineResult struct {
    Input     string
    Verdict   *VerdictOutput
    Execution *ExecutionOutput
    Duration  time.Duration
}

func (p *Pipeline) Execute(ctx context.Context, input string) (*PipelineResult, error) {
    // 1. Validate input
    // 2. Call Agent A
    // 3. Validate Agent A output
    // 4. Call Agent B with verdict
    // 5. Validate Agent B output
    // 6. Return combined result
}
```

### File Location
`internal/pipeline/pipeline.go`

### Error Handling
```go
var (
    ErrInputTooLong    = errors.New("input exceeds 10000 characters")
    ErrVerdictFailed   = errors.New("verdict agent failed")
    ErrExecutionFailed = errors.New("execution agent failed")
    ErrTimeout         = errors.New("pipeline timeout")
)
```

### Validation
- Input: non-empty, max 10,000 chars
- Verdict output: has ruling, rationale is non-empty
- Execution output: has at least 1 phase with tasks

## Dependencies

- [ ] Task 003 (Agent A) - verdict agent
- [ ] Task 004 (Agent B) - execution agent

## Effort Estimate

- Size: M
- Hours: 4-6
- Parallel: false (blocks artifact generation)

## Definition of Done

- [ ] Pipeline executes full Agent A → Agent B flow
- [ ] Validation catches malformed outputs
- [ ] Timeouts work correctly
- [ ] Context cancellation stops pipeline
- [ ] Integration test with mock agents
